@model List<UserRequestVm>

@{
    ViewData["Title"] = "My Previous Approvals";
}

<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/jquery.dataTables.min.css" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>

<style>
    .page-header {
        margin-bottom: 25px;
    }

    .page-title {
        font-size: 26px;
        font-weight: 700;
        color: #0f172a;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .history-card {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }

    .status-badge {
        padding: 6px 10px;
        border-radius: 8px;
        font-size: 12px;
        font-weight: 600;
        display: inline-block;
    }

    .status-pending {
        background: #fef3c7;
        color: #92400e;
    }

    .status-firstapproved {
        background: #dbeafe;
        color: #1e40af;
    }

    .status-finalapproved {
        background: #dcfce7;
        color: #166534;
    }

    .status-rejected {
        background: #fee2e2;
        color: #991b1b;
    }
</style>


<div class="page-header">
    <h1 class="page-title">
        <i class="bi bi-clock-history" style="color:#0ea5e9"></i>
        My Previous Requests
    </h1>
</div>

<div class="history-card">
    <table id="tblHistory" class="display" style="width:100%">
        <thead>
            <tr>
                <th>ID</th>
                <th>Request #</th>
                <th>System</th>
                <th>Status</th>
                <th>Stage</th>
                <th>Created</th>
                <th>Last Update</th>
                <th>View</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var r in Model)
            {
                var css = (r.Status ?? "").ToLower() switch
                {
                    "pending" => "status-pending",
                    "firstapproved" => "status-firstapproved",
                    "finalapproved" => "status-finalapproved",
                    "rejected" => "status-rejected",
                    _ => "status-pending"
                };

                <tr>
                    <td><strong>@r.Id</strong></td>
                    <td>@r.RequestNumber</td>
                    <td>@r.SystemName</td>
                    <td><span class="status-badge @css">@r.Status</span></td>
                    <td>@r.CurrentStage</td>
                    <td>@r.CreatedAt.ToString("yyyy-MM-dd HH:mm")</td>
                    <td>@(r.UpdatedAt?.ToString("yyyy-MM-dd HH:mm") ?? "---")</td>
                    <td>
                        <a href="@Url.Action("Details", "Approvals", new { id = r.Id, system = r.SystemName })"
                           class="btn btn-sm btn-primary">
                            <i class="bi bi-eye"></i> View
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

<script>
    $(document).ready(function () {
        $('#tblHistory').DataTable({
            pageLength: 10,
            order: [[0, 'desc']]
        });
    });
</script>
